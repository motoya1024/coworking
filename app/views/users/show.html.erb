<% provide(:title, 'ミーティングスペース予約画面') %>

<div class="container">  
  <div class="text-center my-5">
    <p class="mb-0">Meeting Spaceの予約</p>
    <h2 class="d-inline-block border-bottom border-dark mb-5">RESERVATION</h2>
    <p class="mb-5">Meeting Spaceを予約したい日時を選択してください。</p>
  </div>
  <div class="reservation_week_form d-inline">
    <%= render 'reservation_week' %>
  </div>
  
  <div class="input-group date d-inline" id="datetimepicker" data-target-input="nearest">
    <input type="hidden" class="datetimepicker-input" data-target="#datetimepicker"/>
    <div class="input-group-append d-inline" data-target="#datetimepicker" data-toggle="datetimepicker">
      <button type="submit" class="ml-3" id="callender"><i class="far fa-calendar-alt btn btn-secondary"></i></button>
    </div>
  </div>
  
  <div class="reservation_status_list">
    <div class="can_reservation"> 
      <div></div>
      <p>予約できます</p>
    </div>
    <div class="can_not_reservation">
      <div></div>
      <p>予約できません</p>
    </div>
  </div>
  <div class="reservation_week_form_table">
    <%= render 'reservation_week_tabale_th' %>
  </div>
  <div class="reservation_week_form_table_body">
    <%= render 'reservation_week_tabale_body' %>
  </div>
  
  <h5><%= @user.name %>様　予約状況一覧</h5>
  <% @login_user_reservations.each do |login_user_reservation| %>
    <table>
        <tr>
            <td><%= l(login_user_reservation.meeting_on, format: :long_mini) %></td>
            <td><%= l(login_user_reservation.started_at, format: :time) %>〜</td>
            <td><%= l(login_user_reservation.finished_at, format: :time) %></td>
        </tr>
        <tr>
            <td><%= link_to '削除', user_reservation_url(@user,login_user_reservation), remote: true %></td>
            <div id="show_user_reservation" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true"></div>
        </tr>
    </table>
  <% end %>
</div>
<script>

$(function(){
  $('#datetimepicker').datetimepicker({
    format: 'L'
  });
  
   $('#datetimepicker').on('change.datetimepicker', function (e) {
       var date = String(e.date).split(" ")[3]+"-"+(new Date(e.date).getMonth() + 1)+"-"+String(e.date).split(" ")[2];
         $.ajax({
                url:'/users/<%= current_user.id %>/change_show',
                type:'GET',
                data:{
                    'prev':date
                }
            });
    });
});    
    
</script>
